var W=Object.defineProperty;var N=(s,r,t)=>r in s?W(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var l=(s,r,t)=>N(s,typeof r!="symbol"?r+"":r,t);import{c as K,d as U,e as j,f as $,g as F,h as D,b as B}from"./DTK_wLMk.js";const b=customElements,C=HTMLElement,{hasAttribute:G,setAttribute:M,removeAttribute:S,getAttribute:y}=C.prototype,{apply:f,setPrototypeOf:x,construct:V}=Reflect,{defineProperties:q}=Object,{get:R,define:_,whenDefined:J}=CustomElementRegistry.prototype,Q=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected").get;function X(s){try{return String(s)}catch{}return""}function Y(s){const{connectedCallback:r,disconnectedCallback:t,adoptedCallback:a,attributeChangedCallback:e,formAssociatedCallback:i,formDisabledCallback:n,formResetCallback:h,formStateRestoreCallback:o}=s.prototype,c=new Set(s.observedAttributes||[]),d=s.formAssociated||!1;return{LatestCtor:s,connectedCallback:r,disconnectedCallback:t,adoptedCallback:a,formAssociatedCallback:i,formDisabledCallback:n,formResetCallback:h,formStateRestoreCallback:o,attributeChangedCallback:e,observedAttributes:c,formAssociated:d}}function O(s,r){return new Set([...s.observedAttributes].filter(t=>!r.observedAttributes.has(t)))}function Z(s,r,t){const{observedAttributes:a,attributeChangedCallback:e}=t;if(a.size===0||!e)return;const i=O(r,t);i.size!==0&&q(s,{setAttribute:{value:function(h,o){if(i.has(h)){const c=y.call(this,h);M.call(this,h,o),e.call(this,h,c,X(o))}else M.call(this,h,o)},writable:!0,enumerable:!0,configurable:!0},removeAttribute:{value:function(h){if(i.has(h)){const o=y.call(this,h);S.call(this,h),e.call(this,h,o,null)}else S.call(this,h)},writable:!0,enumerable:!0,configurable:!0}})}function tt(s,r){var t;return t=class extends C{constructor(e,i){if(super(),e)return A(this,s,e,i),this;e=p.get(r),e?A(this,s,e):(v.set(this,s),x(this,m.prototype))}connectedCallback(){var i;const e=u.get(this);if(e)(i=e.connectedCallback)==null||i.call(this);else{let n=g.get(r);n||g.set(r,n=new Set),n.add(this)}}disconnectedCallback(){var i;const e=u.get(this);if(e)(i=e.disconnectedCallback)==null||i.call(this);else{const n=g.get(r);n&&n.delete(this)}}adoptedCallback(){var i;const e=u.get(this);(i=e==null?void 0:e.adoptedCallback)==null||i.call(this)}formAssociatedCallback(){var i;const e=u.get(this);(i=e==null?void 0:e.formAssociatedCallback)==null||i.apply(this,arguments)}formDisabledCallback(){var i;const e=u.get(this);(i=e==null?void 0:e.formDisabledCallback)==null||i.apply(this,arguments)}formResetCallback(){var i;const e=u.get(this);(i=e==null?void 0:e.formResetCallback)==null||i.apply(this,arguments)}formStateRestoreCallback(){var i;const e=u.get(this);(i=e==null?void 0:e.formStateRestoreCallback)==null||i.apply(this,arguments)}attributeChangedCallback(...e){var n;const i=u.get(this);(s===i||i!=null&&i.observedAttributes.has(e[0]))&&((n=i.attributeChangedCallback)==null||n.apply(this,e))}},t.observedAttributes=s.observedAttributes,t.formAssociated=s.formAssociated,t}let w;const u=new WeakMap,v=new WeakMap,k=new WeakMap,P=new Map,p=new Map,E=new Map,L=new Map,z=new Map,g=new Map;function A(s,r,t,a){var n;x(s,t.LatestCtor.prototype),u.set(s,t),t!==r&&Z(s,r,t),w=s,V(t.LatestCtor,a||[]);const{observedAttributes:e,attributeChangedCallback:i}=t;if(e.size>0&&i){const h=O(r,t);h.size>0&&h.forEach(o=>{if(G.call(s,o)){const c=y.call(s,o);i.call(s,o,null,c)}})}f(Q,s,[])&&((n=t.disconnectedCallback)==null||n.call(s))}function et(s){if(!s||!s.prototype||typeof s.prototype!="object")throw new TypeError("The referenced constructor is not a constructor.");let r=k.get(s);return r||(r=Y(s),k.set(s,r)),r}const m=function(...r){if(!new.target)throw new TypeError("Failed to construct 'HTMLElement': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(new.target===m)throw new TypeError("Illegal constructor");const t=w;if(t)return w=void 0,t;const{constructor:a}=this,e=E.get(a);if(!e||!e.PivotCtor)throw new TypeError("Illegal constructor");return new e.PivotCtor(e,r)};m.prototype=C.prototype;Object.assign(CustomElementRegistry.prototype,{get(...s){var t;if(this!==b)throw new TypeError("Illegal invocation");const{0:r}=s;return f(R,this,s)&&((t=p.get(r))==null?void 0:t.LatestCtor)},define(...s){var o;if(this!==b)throw new TypeError("Illegal invocation");const{0:r,1:t,2:a}=s;if(a&&a.extends)throw new DOMException("NotSupportedError: ");let e=f(R,this,[r]);if(e&&e!==((o=p.get(r))==null?void 0:o.PivotCtor))throw new DOMException(`Failed to execute 'define' on 'CustomElementRegistry': the name "${r}" has already been used with this registry`);const i=et(t);if(E.get(t))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': this constructor has already been used with this registry");p.set(r,i),E.set(t,i),e=P.get(r),e||(e=tt(i,r),P.set(r,e),f(_,this,[r,e])),i.PivotCtor=e;const n=g.get(r);n&&(g.delete(r),n.forEach(c=>{const d=v.get(c);d&&(v.delete(c),A(c,d,i))}));const h=z.get(r);h&&h(t)},whenDefined(...s){if(this!==b)throw new TypeError("Illegal invocation");const{0:r}=s;return f(J,this,s).then(()=>{let t=L.get(r);if(!t){const a=p.get(r);if(a)return Promise.resolve(a.LatestCtor);let e;t=new Promise(i=>{e=i}),L.set(r,t),z.set(r,e)}return t})},constructor:m});window.HTMLElement=m;function st(s){return s.endsWith("/")?s:s===""?"/":s.slice(0,s.lastIndexOf("/")+1)}function T(s,r){if(r.origin!==s.origin)return r.href;if(r.pathname===s.pathname)return"";const t=st(s.pathname);return r.pathname.startsWith(t)?r.pathname.replace(t,"./"):r.pathname}const it=s=>s.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");function rt(s){const r=[];for(const t of s.split(",")){const[a="*",e]=t.split(":"),i="^"+it(a).replace(/\\\*/g,"(.*)")+"$";r.push({regexp:new RegExp(i),append:e})}return r}function at(s,r,t,a){if(!t&&!a)return s;const e=new URL(s),i=new URL(r);if(t&&i.searchParams.forEach((n,h)=>{for(const o of t){if(o.append&&!h.startsWith(o.append)||h===a)continue;const c=o.append?h.replace(o.append,""):h;if(c.match(o.regexp)){e.searchParams.set(c,n);break}}}),a!==null){let n;a==="#"?n=i.hash.slice(1):a.startsWith("/")?i.pathname.startsWith(a)&&(n=T(new URL(a,r),i)):n=i.searchParams.get(a),n&&(e.pathname=new URL(n,s).pathname)}return e.href}function nt(s,r,t,a,e){const i=new URL(s),n=new URL(t),h=new URL(r);if(a){for(const o of n.searchParams.keys().toArray())for(const c of a){if(c.append&&!o.startsWith(c.append))continue;const d=c.append?o.replace(c.append,""):o;if(d.match(c.regexp)){h.searchParams.get(d)===null&&n.searchParams.delete(o);break}}h.searchParams.forEach((o,c)=>{for(const d of a){if(!c.match(d.regexp)||(i==null?void 0:i.searchParams.get(c))===o)continue;const I=d.append?d.append+c:c;n.searchParams.set(I,o);break}})}if(e!==null&&i){const o=T(i,h);e==="#"?n.hash=o:e.startsWith("/")?n.pathname=new URL(o,new URL(e,t)).pathname:o?n.searchParams.set(e,o):n.searchParams.delete(e)}return n}function ot(s){return s.vIframe===!0&&s.uiNotification!==void 0}function ht(s){if(typeof s=="string")return{type:"default",title:s};if(s.error&&!s.errorMsg){const r=s.error.response&&(s.error.response.data||s.error.response.status)||s.error.message||s.error;return s.msg?{type:"error",title:s.msg,detail:r}:{type:"error",title:r}}return s.type==="error"?{type:s.clientError?"warning":"error",title:s.msg,detail:s.errorMsg}:{type:s.type??"default",title:s.msg}}class ct{stateChange(r,t,a){a.log("debug","apply state change on window.history",r,t.href),r==="replace"&&window.history.replaceState(window.history.state,"",t),r==="push"&&window.history.pushState(window.history.state,"",t)}onStateChange(r){window.addEventListener("popstate",r)}}const H=document.createElement("template");H.innerHTML=`<style>
  :host {
    display: block;
  }
  .d-frame-wrapper {
    height: 100%;
  }
  iframe.d-frame-iframe {
    display: block;
    width: 100%;
    height: 100%;
    border: none;
  }
</style><div class="d-frame-wrapper"><slot name="loading"><div style="min-height:150px;"></div></slot><iframe class="d-frame-iframe" style="visibility:hidden;position:absolute;height:0px;"></iframe></div>`;class lt extends HTMLElement{constructor(){super();l(this,"adapter");l(this,"windowAdapter");l(this,"connected",!1);l(this,"childInitialized",!1);l(this,"currentChildSrc",null);l(this,"parsedSyncParams");l(this,"wrapperElement");l(this,"slotElement");l(this,"iframeElement");l(this,"width");l(this,"aspectRatioHeight");l(this,"resizedHeight");l(this,"randomId");l(this,"iframeLoaded",!1);l(this,"ready",!1);l(this,"iframeExtraAttrs",{});l(this,"resizeObserver");l(this,"boundOnMessage",t=>this.onMessage(t));l(this,"mouseEventListeners",{});l(this,"currentSyncedMouseEvents",new Set);this.randomId=Math.random().toString(36).slice(-6);const t=H.content.cloneNode(!0);this.wrapperElement=t.childNodes[1],this.slotElement=this.wrapperElement.childNodes[0],this.iframeElement=this.wrapperElement.childNodes[1],this.iframeElement.addEventListener("load",()=>{this.iframeElement.getAttribute("src")&&(this.log("debug","iframe loaded"),this.iframeLoaded=!0,this.dispatchEvent(new CustomEvent("iframe-load")),this.resize!=="yes"&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()))}),this.attachShadow({mode:"open"}).appendChild(t),this.resizeObserver=new ResizeObserver(e=>{(this.width===void 0||Math.abs(this.width-e[0].contentRect.width)>2)&&(this.width=e[0].contentRect.width,this.updateAspectRatioHeight())}),this.adapter=this.windowAdapter=new ct}get id(){return this.getAttribute("id")??this.randomId}set id(t){this.setAttribute("id",t)}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get fullSrc(){return this.src.startsWith("/")?window.location.origin+this.src:this.src}get aspectRatio(){const t=this.getAttribute("aspect-ratio");return t===""?"auto":t}set aspectRatio(t){t!==null?this.setAttribute("aspect-ratio",t):this.removeAttribute("aspect-ratio")}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}set resize(t){this.setAttribute("resize",t)}get resize(){const t=this.getAttribute("resize");return t===null?"auto":t===""?"yes":t}get syncParams(){return this.getAttribute("sync-params")}set syncParams(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get syncPath(){const t=this.getAttribute("sync-path");return t===null?null:t||"p"}set syncPath(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get stateChangeEvents(){return this.hasAttribute("state-change-events")}set stateChangeEvents(t){t?this.setAttribute("state-change-events",""):this.removeAttribute("state-change-events")}get readyMessage(){return this.hasAttribute("ready-message")}set readyMessage(t){t?this.setAttribute("ready-message",""):this.removeAttribute("ready-message")}get mouseEvents(){const t=this.getAttribute("mouse-events");return t===null?null:t===""?["click","dblclick","mousedown","mouseup"]:t.split(",")}set mouseEvents(t){t===null?this.removeAttribute("mouse-events"):this.setAttribute("mouse-events",t.join(","))}get reload(){return this.getAttribute("reload")}set reload(t){this.setAttribute("reload",t)}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(t){var a;if(t.source===((a=this.iframeElement)==null?void 0:a.contentWindow)){const e=t.data;if(this.log("debug","received message from child",e),Array.isArray(t.data)){if(K(e)&&(this.postMessageToChild(["df-parent","init",{id:this.id,debug:this.debug,resize:this.resize,syncParams:this.syncParams!==null,syncPath:this.syncPath!==null,stateChangeEvents:this.stateChangeEvents,mouseEvents:this.mouseEvents,src:this.currentChildSrc}]),this.childInitialized=!0),U(e)&&(this.resizedHeight=e[2],this.resize==="yes"&&!this.ready&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready"))),this.updateStyle()),j(e)){if(this.currentChildSrc=e[3],this.parsedSyncParams||this.syncPath){const i=nt(this.fullSrc,e[3],window.location.href,this.parsedSyncParams,this.syncPath);if(i.href!==window.location.href){this.log("debug","apply state change to parent",e[2],i.href);try{this.adapter.stateChange(e[2],i,this)}catch(n){this.log("error","failed to apply state change to parent using custom adapter",n),this.windowAdapter.stateChange(e[2],i,this)}}}this.stateChangeEvents&&this.dispatchEvent(new CustomEvent("state-change",{detail:[e[2],e[3]]}))}$(e)&&this.dispatchEvent(new CustomEvent("message",{detail:e[2]})),F(e)&&this.dispatchEvent(new CustomEvent("notif",{detail:e[2]})),D(e)&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()),B(e)&&this.applySyncedMouseEvent(e)}else ot(e)&&this.dispatchEvent(new CustomEvent("notif",{detail:ht(e.uiNotification)}))}}postMessageToChild(t){var a,e;this.log("debug","send message to child",t),(e=(a=this.iframeElement)==null?void 0:a.contentWindow)==null||e.postMessage(t)}updateSrc(){if(!this.connected)return;const t=at(this.fullSrc,window.location.href,this.parsedSyncParams,this.syncPath);t!==this.currentChildSrc&&(this.currentChildSrc=t,this.childInitialized?this.postMessageToChild(["df-parent","updateSrc",t]):(this.log("debug","set src attribute of iframe: "+t),this.iframeElement.setAttribute("src",t)))}updateStyle(){if(!this.connected)return;let t;this.resizedHeight?(this.log("debug","height of iframe based on resize message: "+this.resizedHeight),t=this.resizedHeight+"px"):this.height?(this.log("debug","height of iframe based on direct attribute: "+this.height),t=this.height):this.aspectRatio!==null&&(this.log("debug","height of iframe based on aspect ratio: "+this.aspectRatioHeight),t=this.aspectRatioHeight+"px"),t!==void 0?(this.log("debug","set height iframe wrapper: "+t),this.wrapperElement.setAttribute("style",`height:${t};min-height:0;`)):this.wrapperElement.setAttribute("style",""),this.resize==="yes"||this.resize==="auto"&&this.resizedHeight?this.iframeElement.getAttribute("scrolling")!=="no"&&(this.log("debug","set scrolling attribute of iframe: no"),this.iframeElement.setAttribute("scrolling","no")):this.iframeElement.getAttribute("scrolling")!=="auto"&&(this.log("debug","set scrolling attribute of iframe: auto"),this.iframeElement.setAttribute("scrolling","auto")),this.ready&&this.iframeElement.getAttribute("style")!==""&&(this.log("debug","toggle loading slot and iframe visibility"),this.iframeElement.setAttribute("style",""),this.slotElement.setAttribute("style","display:none;"))}updateAspectRatioHeight(){this.width&&this.aspectRatio!==null&&(this.resizedHeight||this.height||(this.aspectRatioHeight=Math.ceil(this.width/this.actualAspectRatio),this.updateStyle()))}updateIframeExtraAttrs(){const t=this.iframeExtraAttrs,a={};for(const e of this.getAttributeNames())if(e.startsWith("iframe-")){const i=this.getAttribute(e);if(i!==null){const n=e.slice(7);a[n]=i}}this.log("debug","update iframe extra attributes",t,a);for(const e of Object.keys(t))e in a||this.iframeElement.removeAttribute(e);for(const e of Object.keys(a))a[e]!==t[e]&&this.iframeElement.setAttribute(e,a[e])}initMouseEvents(t){this.log("debug","initMouseEvents");for(const a of t)if(!this.mouseEventListeners[a]){const e=i=>{i instanceof MouseEvent&&this.transmitSyncedMouseEvent(["df-global","mouse",a,{altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}])};this.mouseEventListeners[a]=e,document.addEventListener(a,e,!0)}}transmitSyncedMouseEvent(t){this.currentSyncedMouseEvents.has(t[2])?this.currentSyncedMouseEvents.delete(t[2]):this.postMessageToChild(t)}applySyncedMouseEvent(t){this.currentSyncedMouseEvents.add(t[2]);const a=new MouseEvent(t[2],{bubbles:!0,cancelable:!0,view:window,...t[3]});this.dispatchEvent(a)}log(t,...a){t==="debug"&&!this.debug||(t==="debug"&&console.timeLog(`d-frame:${this.id}`,...a),t==="info"&&console.info(`d-frame:${this.id}`,...a),t==="error"&&console.error(`d-frame:${this.id}`,...a))}connectedCallback(){if(!this.debug){const t=window.localStorage.getItem("debug");if(t){const a=t.split(",");(a.includes("d-frame")||a.includes("d-frame:"+this.id))&&(this.debug=!0)}}if(this.debug&&console.time(`d-frame:${this.id}`),!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.connected=!0,this.adapter.onStateChange&&this.adapter.onStateChange(()=>{this.updateSrc()}),this.resizeObserver.observe(this),window.addEventListener("message",this.boundOnMessage),this.syncParams!==null&&(this.parsedSyncParams=rt(this.syncParams||"*")),this.updateStyle(),this.updateIframeExtraAttrs(),this.updateSrc(),this.mouseEvents&&this.initMouseEvents(this.mouseEvents)}disconnectedCallback(){this.log("debug","disconnected"),this.resizeObserver.disconnect(),window.removeEventListener("message",this.boundOnMessage);for(const[t,a]of Object.entries(this.mouseEventListeners))document.removeEventListener(t,a,!0),delete this.mouseEventListeners[t]}static get observedAttributes(){return["src","aspect-ratio","height","sync-params","sync-path","reload"]}attributeChangedCallback(t,a,e){var i;if(t==="aspect-ratio"&&this.updateAspectRatioHeight(),!!this.connected&&(this.log("debug","attribute change",t,a,e),t==="src"&&this.updateSrc(),t==="height"&&this.updateStyle(),t==="sync-params"&&this.updateSrc(),t==="sync-path"&&this.updateSrc(),t==="reload")){if(!this.currentChildSrc){this.log("debug","reload attribute changed but no iframe previously src");return}if(!((i=this.iframeElement.contentWindow)!=null&&i.location)){this.log("debug","reload attribute changed but no iframe contentWindow, is this a cross domain iframe ?");return}this.log("debug","reload iframe with current src",this.currentChildSrc),this.childInitialized=!1,this.iframeElement.setAttribute("src",this.currentChildSrc),this.iframeElement.contentWindow.location.reload()}}}customElements.define("d-frame",lt);
