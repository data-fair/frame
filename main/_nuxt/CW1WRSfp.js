var u=Object.defineProperty;var n=(r,s,t)=>s in r?u(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var a=(r,s,t)=>n(r,typeof s!="symbol"?s+"":s,t);import{a as c,b as g}from"./BUDPeZol.js";const o=document.createElement("template");o.innerHTML=`
  <style>
    :host {
      display: block;
    }
    iframe.d-frame-iframe {
      width: 100%;
      border: none;
      max-height: 100%;
    }
  </style>
`;class b extends HTMLElement{constructor(){super();a(this,"iframe");a(this,"width");a(this,"height");a(this,"resizedHeight");const t=this.attachShadow({mode:"open"});t.appendChild(o.content.cloneNode(!0)),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("class","d-frame-iframe"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("scrolling","auto"),this.iframe.setAttribute("loading",this.lazy?"lazy":"eager"),t.appendChild(this.iframe),new ResizeObserver(e=>{this.width!==e[0].contentRect.width&&(this.width=e[0].contentRect.width,this.updateHeight())}).observe(this),window.addEventListener("message",e=>this.onMessage(e))}static get observedAttributes(){return["src","aspect-ratio"]}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}get lazy(){return this.hasAttribute("lazy")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get aspectRatio(){return this.getAttribute("aspect-ratio")??"auto"}set aspectRatio(t){this.setAttribute("aspect-ratio",t)}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(t){var i;if(t.source===((i=this.iframe)==null?void 0:i.contentWindow)&&typeof t.data=="object"&&t.data.dFrame==="child"){const e=t.data;this.log("debug","received message from child",e),c(e)&&this.postMessageToIframe("init",{debug:this.debug}),g(e)&&(this.resizedHeight=this.height=e.data,this.updateStyle())}}postMessageToIframe(t,i){var h,d;const e={dFrame:"parent",type:t,data:i};this.log("debug","send message to child",e),(d=(h=this.iframe)==null?void 0:h.contentWindow)==null||d.postMessage(e)}updateSrc(){this.iframe.setAttribute("src",this.src)}updateStyle(){let t="";this.height&&(this.iframe.setAttribute("scrolling","no"),t+=`height:${this.height}px;`),this.iframe.setAttribute("style",t)}updateHeight(){this.width&&(this.resizedHeight||(this.height=this.width/this.actualAspectRatio,this.updateStyle()))}log(t,...i){t==="debug"&&!this.debug||(t==="debug"&&console.debug("d-frame",...i),t==="info"&&console.info("d-frame",...i))}connectedCallback(){if(!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.updateSrc(),this.updateStyle()}attributeChangedCallback(t,i,e){this.log("debug","attribute change",t,i,e),t==="aspect-ratio"&&this.updateHeight(),t==="src"&&this.updateSrc()}}customElements.define("d-frame",b);
