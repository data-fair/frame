var O=Object.defineProperty;var N=(s,i,t)=>i in s?O(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var l=(s,i,t)=>N(s,typeof i!="symbol"?i+"":i,t);import{c as W,d as K,e as j,f as U,g as $,h as F,b as D}from"./DTK_wLMk.js";const y=customElements,M=HTMLElement,{hasAttribute:B,setAttribute:S,removeAttribute:R,getAttribute:w}=M.prototype,{apply:f,setPrototypeOf:L,construct:G}=Reflect,{defineProperties:V}=Object,{get:P,define:q,whenDefined:_}=CustomElementRegistry.prototype,J=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected").get;function Q(s){try{return String(s)}catch{}return""}function X(s){const{connectedCallback:i,disconnectedCallback:t,adoptedCallback:a,attributeChangedCallback:e,formAssociatedCallback:r,formDisabledCallback:n,formResetCallback:o,formStateRestoreCallback:h}=s.prototype,c=new Set(s.observedAttributes||[]),d=s.formAssociated||!1;return{LatestCtor:s,connectedCallback:i,disconnectedCallback:t,adoptedCallback:a,formAssociatedCallback:r,formDisabledCallback:n,formResetCallback:o,formStateRestoreCallback:h,attributeChangedCallback:e,observedAttributes:c,formAssociated:d}}function T(s,i){return new Set([...s.observedAttributes].filter(t=>!i.observedAttributes.has(t)))}function Y(s,i,t){const{observedAttributes:a,attributeChangedCallback:e}=t;if(a.size===0||!e)return;const r=T(i,t);r.size!==0&&V(s,{setAttribute:{value:function(o,h){if(r.has(o)){const c=w.call(this,o);S.call(this,o,h),e.call(this,o,c,Q(h))}else S.call(this,o,h)},writable:!0,enumerable:!0,configurable:!0},removeAttribute:{value:function(o){if(r.has(o)){const h=w.call(this,o);R.call(this,o),e.call(this,o,h,null)}else R.call(this,o)},writable:!0,enumerable:!0,configurable:!0}})}function Z(s,i){var t;return t=class extends M{constructor(e,r){if(super(),e)return C(this,s,e,r),this;e=p.get(i),e?C(this,s,e):(E.set(this,s),L(this,m.prototype))}connectedCallback(){var r;const e=u.get(this);if(e)(r=e.connectedCallback)==null||r.call(this);else{let n=g.get(i);n||g.set(i,n=new Set),n.add(this)}}disconnectedCallback(){var r;const e=u.get(this);if(e)(r=e.disconnectedCallback)==null||r.call(this);else{const n=g.get(i);n&&n.delete(this)}}adoptedCallback(){var r;const e=u.get(this);(r=e==null?void 0:e.adoptedCallback)==null||r.call(this)}formAssociatedCallback(){var r;const e=u.get(this);(r=e==null?void 0:e.formAssociatedCallback)==null||r.apply(this,arguments)}formDisabledCallback(){var r;const e=u.get(this);(r=e==null?void 0:e.formDisabledCallback)==null||r.apply(this,arguments)}formResetCallback(){var r;const e=u.get(this);(r=e==null?void 0:e.formResetCallback)==null||r.apply(this,arguments)}formStateRestoreCallback(){var r;const e=u.get(this);(r=e==null?void 0:e.formStateRestoreCallback)==null||r.apply(this,arguments)}attributeChangedCallback(...e){var n;const r=u.get(this);(s===r||r!=null&&r.observedAttributes.has(e[0]))&&((n=r.attributeChangedCallback)==null||n.apply(this,e))}},t.observedAttributes=s.observedAttributes,t.formAssociated=s.formAssociated,t}let v;const u=new WeakMap,E=new WeakMap,k=new WeakMap,z=new Map,p=new Map,A=new Map,x=new Map,H=new Map,g=new Map;function C(s,i,t,a){var n;L(s,t.LatestCtor.prototype),u.set(s,t),t!==i&&Y(s,i,t),v=s,G(t.LatestCtor,a||[]);const{observedAttributes:e,attributeChangedCallback:r}=t;if(e.size>0&&r){const o=T(i,t);o.size>0&&o.forEach(h=>{if(B.call(s,h)){const c=w.call(s,h);r.call(s,h,null,c)}})}f(J,s,[])&&((n=t.disconnectedCallback)==null||n.call(s))}function tt(s){if(!s||!s.prototype||typeof s.prototype!="object")throw new TypeError("The referenced constructor is not a constructor.");let i=k.get(s);return i||(i=X(s),k.set(s,i)),i}const m=function(...i){if(!new.target)throw new TypeError("Failed to construct 'HTMLElement': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(new.target===m)throw new TypeError("Illegal constructor");const t=v;if(t)return v=void 0,t;const{constructor:a}=this,e=A.get(a);if(!e||!e.PivotCtor)throw new TypeError("Illegal constructor");return new e.PivotCtor(e,i)};m.prototype=M.prototype;Object.assign(CustomElementRegistry.prototype,{get(...s){var t;if(this!==y)throw new TypeError("Illegal invocation");const{0:i}=s;return f(P,this,s)&&((t=p.get(i))==null?void 0:t.LatestCtor)},define(...s){var h;if(this!==y)throw new TypeError("Illegal invocation");const{0:i,1:t,2:a}=s;if(a&&a.extends)throw new DOMException("NotSupportedError: ");let e=f(P,this,[i]);if(e&&e!==((h=p.get(i))==null?void 0:h.PivotCtor))throw new DOMException(`Failed to execute 'define' on 'CustomElementRegistry': the name "${i}" has already been used with this registry`);const r=tt(t);if(A.get(t))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': this constructor has already been used with this registry");p.set(i,r),A.set(t,r),e=z.get(i),e||(e=Z(r,i),z.set(i,e),f(q,this,[i,e])),r.PivotCtor=e;const n=g.get(i);n&&(g.delete(i),n.forEach(c=>{const d=E.get(c);d&&(E.delete(c),C(c,d,r))}));const o=H.get(i);o&&o(t)},whenDefined(...s){if(this!==y)throw new TypeError("Illegal invocation");const{0:i}=s;return f(_,this,s).then(()=>{let t=x.get(i);if(!t){const a=p.get(i);if(a)return Promise.resolve(a.LatestCtor);let e;t=new Promise(r=>{e=r}),x.set(i,t),H.set(i,e)}return t})},constructor:m});window.HTMLElement=m;function et(s){return s.endsWith("/")?s:s===""?"/":s.slice(0,s.lastIndexOf("/")+1)}function st(s,i){if(i.origin!==s.origin)return i.href;if(i.pathname===s.pathname)return"";const t=et(s.pathname);return i.pathname.startsWith(t)?i.pathname.replace(t,"./"):i.pathname}const it=s=>s.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");function rt(s){const i=[];for(const t of s.split(",")){const[a="*",e]=t.split(":"),r="^"+it(a).replace(/\\\*/g,"(.*)")+"$";i.push({regexp:new RegExp(r),append:e})}return i}function at(s,i,t,a){if(!t&&!a)return s;const e=new URL(s),r=new URL(i);if(t&&r.searchParams.forEach((n,o)=>{for(const h of t){if(h.append&&!o.startsWith(h.append)||o===a)continue;const c=h.append?o.replace(h.append,""):o;if(c.match(h.regexp)){e.searchParams.set(c,n);break}}}),a!==null){const n=r.searchParams.get(a);n&&(e.pathname=new URL(n,s).pathname)}return e.href}function nt(s,i,t,a,e){const r=new URL(s),n=new URL(t),o=new URL(i);if(a&&(n.searchParams.forEach((h,c)=>{for(const d of a){if(d.append&&!c.startsWith(d.append))continue;const b=d.append?c.replace(d.append,""):c;if(b.match(d.regexp)){o.searchParams.get(b)===null&&n.searchParams.delete(c);break}}}),o.searchParams.forEach((h,c)=>{for(const d of a){if(!c.match(d.regexp)||(r==null?void 0:r.searchParams.get(c))===h)continue;const b=d.append?d.append+c:c;n.searchParams.set(b,h);break}})),e!==null&&r){const h=st(r,o);h?n.searchParams.set(e,h):n.searchParams.delete(e)}return n}function ot(s){return s.vIframe===!0&&s.uiNotification!==void 0}function ht(s){if(typeof s=="string")return{type:"default",title:s};if(s.error&&!s.errorMsg){const i=s.error.response&&(s.error.response.data||s.error.response.status)||s.error.message||s.error;return s.msg?{type:"error",title:s.msg,detail:i}:{type:"error",title:i}}return s.type==="error"?{type:s.clientError?"warning":"error",title:s.msg,detail:s.errorMsg}:{type:s.type??"default",title:s.msg}}class ct{stateChange(i,t){i==="replace"&&window.history.replaceState(window.history.state,"",t),i==="push"&&window.history.pushState(window.history.state,"",t)}onStateChange(i){window.addEventListener("popstate",i)}}const I=document.createElement("template");I.innerHTML=`<style>
  :host {
    display: block;
  }
  .d-frame-wrapper {
    height: 100%;
  }
  iframe.d-frame-iframe {
    display: block;
    width: 100%;
    height: 100%;
    border: none;
  }
</style><div class="d-frame-wrapper"><slot name="loading"><div style="min-height:150px;"></div></slot><iframe class="d-frame-iframe" style="visibility:hidden;position:absolute;height:0px;"></iframe></div>`;class lt extends HTMLElement{constructor(){super();l(this,"adapter");l(this,"connected",!1);l(this,"childInitialized",!1);l(this,"currentChildSrc",null);l(this,"parsedSyncParams");l(this,"wrapperElement");l(this,"slotElement");l(this,"iframeElement");l(this,"width");l(this,"aspectRatioHeight");l(this,"resizedHeight");l(this,"randomId");l(this,"iframeLoaded",!1);l(this,"ready",!1);l(this,"iframeExtraAttrs",{});l(this,"currentSyncedMouseEvents",new Set);this.randomId=Math.random().toString(36).slice(-6);const t=I.content.cloneNode(!0);this.wrapperElement=t.childNodes[1],this.slotElement=this.wrapperElement.childNodes[0],this.iframeElement=this.wrapperElement.childNodes[1],this.iframeElement.addEventListener("load",()=>{this.iframeElement.getAttribute("src")&&(this.log("debug","iframe loaded"),this.iframeLoaded=!0,this.dispatchEvent(new CustomEvent("iframe-load")),this.resize!=="yes"&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()))}),this.attachShadow({mode:"open"}).appendChild(t),new ResizeObserver(r=>{(this.width===void 0||Math.abs(this.width-r[0].contentRect.width)>2)&&(this.width=r[0].contentRect.width,this.updateAspectRatioHeight())}).observe(this),this.adapter=new ct,window.addEventListener("message",r=>this.onMessage(r))}get id(){return this.getAttribute("id")??this.randomId}set id(t){this.setAttribute("id",t)}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get fullSrc(){return this.src.startsWith("/")?window.location.origin+this.src:this.src}get aspectRatio(){const t=this.getAttribute("aspect-ratio");return t===""?"auto":t}set aspectRatio(t){t!==null?this.setAttribute("aspect-ratio",t):this.removeAttribute("aspect-ratio")}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}set resize(t){this.setAttribute("resize",t)}get resize(){const t=this.getAttribute("resize");return t===null?"auto":t===""?"yes":t}get syncParams(){return this.getAttribute("sync-params")}set syncParams(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get syncPath(){const t=this.getAttribute("sync-path");return t===null?null:t||"p"}set syncPath(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get stateChangeEvents(){return this.hasAttribute("state-change-events")}set stateChangeEvents(t){t?this.setAttribute("state-change-events",""):this.removeAttribute("state-change-events")}get readyMessage(){return this.hasAttribute("ready-message")}set readyMessage(t){t?this.setAttribute("ready-message",""):this.removeAttribute("ready-message")}get mouseEvents(){const t=this.getAttribute("mouse-events");return t===null?null:t===""?["click","dblclick","mousedown","mouseup"]:t.split(",")}set mouseEvents(t){t===null?this.removeAttribute("mouse-events"):this.setAttribute("mouse-events",t.join(","))}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(t){var a;if(t.source===((a=this.iframeElement)==null?void 0:a.contentWindow)){const e=t.data;if(this.log("debug","received message from child",e),Array.isArray(t.data)){if(W(e)&&(this.postMessageToChild(["df-parent","init",{id:this.id,debug:this.debug,resize:this.resize,syncParams:this.syncParams!==null,syncPath:this.syncPath!==null,stateChangeEvents:this.stateChangeEvents,mouseEvents:this.mouseEvents}]),this.childInitialized=!0),K(e)&&(this.resizedHeight=e[2],this.resize==="yes"&&!this.ready&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready"))),this.updateStyle()),j(e)){if(this.currentChildSrc=e[3],this.parsedSyncParams||this.syncPath){const r=nt(this.fullSrc,e[3],window.location.href,this.parsedSyncParams,this.syncPath);r.href!==window.location.href&&(console.log("parent push stateChange",e[2],e[3]),this.adapter.stateChange(e[2],r))}this.stateChangeEvents&&this.dispatchEvent(new CustomEvent("state-change",{detail:[e[2],e[3]]}))}U(e)&&this.dispatchEvent(new CustomEvent("message",{detail:e[2]})),$(e)&&this.dispatchEvent(new CustomEvent("notif",{detail:e[2]})),F(e)&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()),D(e)&&this.applySyncedMouseEvent(e)}else ot(e)&&this.dispatchEvent(new CustomEvent("notif",{detail:ht(e.uiNotification)}))}}postMessageToChild(t){var a,e;this.log("debug","send message to child",t),(e=(a=this.iframeElement)==null?void 0:a.contentWindow)==null||e.postMessage(t)}updateSrc(){if(!this.connected)return;const t=at(this.fullSrc,window.location.href,this.parsedSyncParams,this.syncPath);t!==this.currentChildSrc&&(this.currentChildSrc=t,this.childInitialized?this.postMessageToChild(["df-parent","updateSrc",t]):(this.log("debug","set src attribute of iframe: "+t),this.iframeElement.setAttribute("src",t)))}updateStyle(){if(!this.connected)return;let t;this.resizedHeight?(this.log("debug","height of iframe based on resize message: "+this.resizedHeight),t=this.resizedHeight+"px"):this.height?(this.log("debug","height of iframe based on direct attribute: "+this.height),t=this.height):this.aspectRatio!==null&&(this.log("debug","height of iframe based on aspect ratio: "+this.aspectRatioHeight),t=this.aspectRatioHeight+"px"),t!==void 0?(this.log("debug","set height iframe wrapper: "+t),this.wrapperElement.setAttribute("style",`height:${t};min-height:0;`)):this.wrapperElement.setAttribute("style",""),this.resize==="yes"||this.resize==="auto"&&this.resizedHeight?this.iframeElement.getAttribute("scrolling")!=="no"&&(this.log("debug","set scrolling attribute of iframe: no"),this.iframeElement.setAttribute("scrolling","no")):this.iframeElement.getAttribute("scrolling")!=="auto"&&(this.log("debug","set scrolling attribute of iframe: auto"),this.iframeElement.setAttribute("scrolling","auto")),this.ready&&this.iframeElement.getAttribute("style")!==""&&(this.log("debug","toggle loading slot and iframe visibility"),this.iframeElement.setAttribute("style",""),this.slotElement.setAttribute("style","display:none;"))}updateAspectRatioHeight(){this.width&&this.aspectRatio!==null&&(this.resizedHeight||this.height||(this.aspectRatioHeight=Math.ceil(this.width/this.actualAspectRatio),this.updateStyle()))}updateIframeExtraAttrs(){const t=this.iframeExtraAttrs,a={};for(const e of this.getAttributeNames())if(e.startsWith("iframe-")){const r=this.getAttribute(e);if(r!==null){const n=e.slice(7);a[n]=r}}this.log("debug","update iframe extra attributes",t,a);for(const e of Object.keys(t))e in a||this.iframeElement.removeAttribute(e);for(const e of Object.keys(a))a[e]!==t[e]&&this.iframeElement.setAttribute(e,a[e])}initMouseEvents(t){this.log("debug","initMouseEvents");for(const a of t)document.addEventListener(a,e=>{e instanceof MouseEvent&&this.transmitSyncedMouseEvent(["df-global","mouse",a,{altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey}])},!0)}transmitSyncedMouseEvent(t){this.currentSyncedMouseEvents.has(t[2])?this.currentSyncedMouseEvents.delete(t[2]):this.postMessageToChild(t)}applySyncedMouseEvent(t){this.currentSyncedMouseEvents.add(t[2]);const a=new MouseEvent(t[2],{bubbles:!0,cancelable:!0,view:window,...t[3]});this.dispatchEvent(a)}log(t,...a){t==="debug"&&!this.debug||(t==="debug"&&console.timeLog(`d-frame:${this.id}`,...a),t==="info"&&console.info(`d-frame:${this.id}`,...a))}connectedCallback(){if(!this.debug){const t=window.localStorage.getItem("debug");if(t){const a=t.split(",");(a.includes("d-frame")||a.includes("d-frame:"+this.id))&&(this.debug=!0)}}if(this.debug&&console.time(`d-frame:${this.id}`),!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.connected=!0,this.adapter.onStateChange&&this.adapter.onStateChange(()=>{this.updateSrc()}),this.syncParams!==null&&(this.parsedSyncParams=rt(this.syncParams||"*")),this.updateStyle(),this.updateIframeExtraAttrs(),this.updateSrc(),this.mouseEvents&&this.initMouseEvents(this.mouseEvents)}disconnectedCallback(){this.log("debug","disconnected"),this.debug&&console.timeEnd(`d-frame:${this.id}`)}static get observedAttributes(){return["src","aspect-ratio","height","sync-params","sync-path"]}attributeChangedCallback(t,a,e){t==="aspect-ratio"&&this.updateAspectRatioHeight(),t.startsWith("iframe-")&&this.updateIframeExtraAttrs(),this.connected&&(this.log("debug","attribute change",t,a,e),t==="src"&&this.updateSrc(),t==="height"&&this.updateStyle(),t==="sync-params"&&this.updateSrc(),t==="sync-path"&&this.updateSrc())}}customElements.define("d-frame",lt);
