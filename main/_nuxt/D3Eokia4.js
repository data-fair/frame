var F=Object.defineProperty;var D=(s,r,e)=>r in s?F(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e;var c=(s,r,e)=>D(s,typeof r!="symbol"?r+"":r,e);import{d as q,e as B,f as G,g as V,h as _,j as J,b as Q,k as X,l as Y}from"./90EmMKhs.js";const y=customElements,M=HTMLElement,{hasAttribute:Z,setAttribute:R,removeAttribute:P,getAttribute:v}=M.prototype,{apply:p,setPrototypeOf:W,construct:ee}=Reflect,{defineProperties:te}=Object,{get:L,define:se,whenDefined:ie}=CustomElementRegistry.prototype,re=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected").get;function ae(s){try{return String(s)}catch{}return""}function ne(s){const{connectedCallback:r,disconnectedCallback:e,adoptedCallback:a,attributeChangedCallback:t,formAssociatedCallback:i,formDisabledCallback:n,formResetCallback:h,formStateRestoreCallback:o}=s.prototype,l=new Set(s.observedAttributes||[]),d=s.formAssociated||!1;return{LatestCtor:s,connectedCallback:r,disconnectedCallback:e,adoptedCallback:a,formAssociatedCallback:i,formDisabledCallback:n,formResetCallback:h,formStateRestoreCallback:o,attributeChangedCallback:t,observedAttributes:l,formAssociated:d}}function N(s,r){return new Set([...s.observedAttributes].filter(e=>!r.observedAttributes.has(e)))}function oe(s,r,e){const{observedAttributes:a,attributeChangedCallback:t}=e;if(a.size===0||!t)return;const i=N(r,e);i.size!==0&&te(s,{setAttribute:{value:function(h,o){if(i.has(h)){const l=v.call(this,h);R.call(this,h,o),t.call(this,h,l,ae(o))}else R.call(this,h,o)},writable:!0,enumerable:!0,configurable:!0},removeAttribute:{value:function(h){if(i.has(h)){const o=v.call(this,h);P.call(this,h),t.call(this,h,o,null)}else P.call(this,h)},writable:!0,enumerable:!0,configurable:!0}})}function he(s,r){var e;return e=class extends M{constructor(t,i){if(super(),t)return S(this,s,t,i),this;t=g.get(r),t?S(this,s,t):(C.set(this,s),W(this,b.prototype))}connectedCallback(){var i;const t=u.get(this);if(t)(i=t.connectedCallback)==null||i.call(this);else{let n=m.get(r);n||m.set(r,n=new Set),n.add(this)}}disconnectedCallback(){var i;const t=u.get(this);if(t)(i=t.disconnectedCallback)==null||i.call(this);else{const n=m.get(r);n&&n.delete(this)}}adoptedCallback(){var i;const t=u.get(this);(i=t==null?void 0:t.adoptedCallback)==null||i.call(this)}formAssociatedCallback(){var i;const t=u.get(this);(i=t==null?void 0:t.formAssociatedCallback)==null||i.apply(this,arguments)}formDisabledCallback(){var i;const t=u.get(this);(i=t==null?void 0:t.formDisabledCallback)==null||i.apply(this,arguments)}formResetCallback(){var i;const t=u.get(this);(i=t==null?void 0:t.formResetCallback)==null||i.apply(this,arguments)}formStateRestoreCallback(){var i;const t=u.get(this);(i=t==null?void 0:t.formStateRestoreCallback)==null||i.apply(this,arguments)}attributeChangedCallback(...t){var n;const i=u.get(this);(s===i||i!=null&&i.observedAttributes.has(t[0]))&&((n=i.attributeChangedCallback)==null||n.apply(this,t))}},e.observedAttributes=s.observedAttributes,e.formAssociated=s.formAssociated,e}let E;const u=new WeakMap,C=new WeakMap,k=new WeakMap,T=new Map,g=new Map,A=new Map,x=new Map,z=new Map,m=new Map;function S(s,r,e,a){var n;W(s,e.LatestCtor.prototype),u.set(s,e),e!==r&&oe(s,r,e),E=s,ee(e.LatestCtor,a||[]);const{observedAttributes:t,attributeChangedCallback:i}=e;if(t.size>0&&i){const h=N(r,e);h.size>0&&h.forEach(o=>{if(Z.call(s,o)){const l=v.call(s,o);i.call(s,o,null,l)}})}p(re,s,[])&&((n=e.disconnectedCallback)==null||n.call(s))}function le(s){if(!s||!s.prototype||typeof s.prototype!="object")throw new TypeError("The referenced constructor is not a constructor.");let r=k.get(s);return r||(r=ne(s),k.set(s,r)),r}const b=function(...r){if(!new.target)throw new TypeError("Failed to construct 'HTMLElement': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(new.target===b)throw new TypeError("Illegal constructor");const e=E;if(e)return E=void 0,e;const{constructor:a}=this,t=A.get(a);if(!t||!t.PivotCtor)throw new TypeError("Illegal constructor");return new t.PivotCtor(t,r)};b.prototype=M.prototype;Object.assign(CustomElementRegistry.prototype,{get(...s){var e;if(this!==y)throw new TypeError("Illegal invocation");const{0:r}=s;return p(L,this,s)&&((e=g.get(r))==null?void 0:e.LatestCtor)},define(...s){var o;if(this!==y)throw new TypeError("Illegal invocation");const{0:r,1:e,2:a}=s;if(a&&a.extends)throw new DOMException("NotSupportedError: ");let t=p(L,this,[r]);if(t&&t!==((o=g.get(r))==null?void 0:o.PivotCtor))throw new DOMException(`Failed to execute 'define' on 'CustomElementRegistry': the name "${r}" has already been used with this registry`);const i=le(e);if(A.get(e))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': this constructor has already been used with this registry");g.set(r,i),A.set(e,i),t=T.get(r),t||(t=he(i,r),T.set(r,t),p(se,this,[r,t])),i.PivotCtor=t;const n=m.get(r);n&&(m.delete(r),n.forEach(l=>{const d=C.get(l);d&&(C.delete(l),S(l,d,i))}));const h=z.get(r);h&&h(e)},whenDefined(...s){if(this!==y)throw new TypeError("Illegal invocation");const{0:r}=s;return p(ie,this,s).then(()=>{let e=x.get(r);if(!e){const a=g.get(r);if(a)return Promise.resolve(a.LatestCtor);let t;e=new Promise(i=>{t=i}),x.set(r,e),z.set(r,t)}return e})},constructor:b});window.HTMLElement=b;function ce(s){return s.endsWith("/")?s:s===""?"/":s.slice(0,s.lastIndexOf("/")+1)}function O(s){return s.endsWith("/")?s:s+"/"}function j(s,r){if(r.origin!==s.origin)return r.href;if(O(r.pathname)===O(s.pathname))return"";const e=ce(s.pathname);return r.pathname.startsWith(e)?r.pathname.replace(e,""):r.pathname}const de=s=>s.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");function ue(s){const r=[];for(const e of s.split(",")){const[a="*",t]=e.split(":"),i="^"+de(a).replace(/\\\*/g,"(.*)")+"$";r.push({regexp:new RegExp(i),append:t})}return r}function fe(s,r,e,a){if(!e&&!a)return s;const t=new URL(s),i=new URL(r);if(e&&i.searchParams.forEach((n,h)=>{for(const o of e){if(o.append&&!h.startsWith(o.append)||h===a)continue;const l=o.append?h.replace(o.append,""):h;if(l.match(o.regexp)){t.searchParams.set(l,n);break}}}),a!==null){let n;a==="#"?n=i.hash.slice(1):a.startsWith("/")?i.pathname.startsWith(a)&&(n=j(new URL(a,r),i)):n=i.searchParams.get(a),n&&(t.pathname=new URL(n,s).pathname)}return t.href}function w(s,r,e,a,t){const i=new URL(s),n=new URL(e),h=new URL(r);if(a){for(const o of n.searchParams.keys().toArray())for(const l of a){if(l.append&&!o.startsWith(l.append))continue;const d=l.append?o.replace(l.append,""):o;if(d.match(l.regexp)){h.searchParams.get(d)===null&&n.searchParams.delete(o);break}}h.searchParams.forEach((o,l)=>{for(const d of a){if(!l.match(d.regexp)||(i==null?void 0:i.searchParams.get(l))===o)continue;const $=d.append?d.append+l:l;n.searchParams.set($,o);break}})}if(t!==null&&i){const o=j(i,h);t==="#"?n.hash=o:t.startsWith("/")?o===""||o.startsWith("/")?n.pathname=t:n.pathname=new URL(o,new URL(t,e)).pathname:o?n.searchParams.set(t,o):n.searchParams.delete(t)}return n}function pe(s){return s.vIframe===!0&&s.uiNotification!==void 0}function ge(s){if(typeof s=="string")return{type:"default",title:s};if(s.error&&!s.errorMsg){const r=s.error.response&&(s.error.response.data||s.error.response.status)||s.error.message||s.error;return s.msg?{type:"error",title:s.msg,detail:r}:{type:"error",title:r}}return s.type==="error"?{type:s.clientError?"warning":"error",title:s.msg,detail:s.errorMsg}:{type:s.type??"default",title:s.msg}}class me{stateChange(r,e,a){a.log("debug","apply state change on window.history",r,e.href),r==="replace"&&window.history.replaceState(window.history.state,"",e),r==="push"&&window.history.pushState(window.history.state,"",e)}onStateChange(r){window.addEventListener("popstate",r)}}var I,U;const f=((I=document.head)==null?void 0:I.querySelector("meta[property=csp-nonce]"))??((U=document.head)==null?void 0:U.querySelector("meta[name=csp-nonce]")),H=(f==null?void 0:f.nonce)??(f==null?void 0:f.content),K=document.createElement("template");K.innerHTML=`<style${H?` nonce="${H}"`:""}>
  :host {
    display: block;
  }
  .d-frame-wrapper {
    height: 100%;
  }
  .d-frame-wrapper .loading-placeholder {
    min-height:150px;
  }
  iframe.d-frame-iframe {
    display: block;
    width: 100%;
    height: 100%;
    border: none;
    user-select: none;
  }
</style><div class="d-frame-wrapper"><slot name="loading"><div class="loading-placeholder"></div></slot><iframe class="d-frame-iframe"></iframe></div>`;class be extends HTMLElement{constructor(){super();c(this,"adapter");c(this,"windowAdapter");c(this,"connected",!1);c(this,"childInitialized",!1);c(this,"currentChildSrc",null);c(this,"parsedSyncParams");c(this,"wrapperElement");c(this,"slotElement");c(this,"iframeElement");c(this,"width");c(this,"aspectRatioHeight");c(this,"resizedHeight");c(this,"randomId");c(this,"iframeLoaded",!1);c(this,"ready",!1);c(this,"iframeExtraAttrs",{});c(this,"resizeObserver");c(this,"boundOnMessage",e=>this.onMessage(e));c(this,"mouseEventListeners",{});c(this,"parentUrlListeners",{});c(this,"currentSyncedMouseEvents",new Set);this.randomId=Math.random().toString(36).slice(-6);const e=K.content.cloneNode(!0);this.wrapperElement=e.childNodes[1],this.slotElement=this.wrapperElement.childNodes[0],this.iframeElement=this.wrapperElement.childNodes[1],this.iframeElement.style.cssText="visibility:hidden;position:absolute;height:0px;",this.iframeElement.addEventListener("load",()=>{this.iframeElement.getAttribute("src")&&(this.log("debug","iframe loaded"),this.iframeLoaded=!0,this.dispatchEvent(new CustomEvent("iframe-load")),this.resize!=="yes"&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()))}),this.attachShadow({mode:"open"}).appendChild(e),this.resizeObserver=new ResizeObserver(t=>{(this.width===void 0||Math.abs(this.width-t[0].contentRect.width)>2)&&(this.width=t[0].contentRect.width,this.updateAspectRatioHeight())}),this.adapter=this.windowAdapter=new me}get id(){return this.getAttribute("id")??this.randomId}set id(e){this.setAttribute("id",e)}get debug(){return this.hasAttribute("debug")}set debug(e){e?this.setAttribute("debug",""):this.removeAttribute("debug")}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",e)}get fullSrc(){return this.src.startsWith("/")?window.location.origin+this.src:this.src}get aspectRatio(){const e=this.getAttribute("aspect-ratio");return e===""?"auto":e}set aspectRatio(e){e!==null?this.setAttribute("aspect-ratio",e):this.removeAttribute("aspect-ratio")}get height(){return this.getAttribute("height")}set height(e){e?this.setAttribute("height",e):this.removeAttribute("height")}set resize(e){this.setAttribute("resize",e)}get resize(){const e=this.getAttribute("resize");return e===null?"auto":e===""?"yes":e}get syncParams(){return this.getAttribute("sync-params")}set syncParams(e){e!==null?this.setAttribute("sync-params",e):this.removeAttribute("sync-params")}get syncPath(){const e=this.getAttribute("sync-path");return e===null?null:e||"p"}set syncPath(e){e!==null?this.setAttribute("sync-params",e):this.removeAttribute("sync-params")}get stateChangeEvents(){return this.hasAttribute("state-change-events")}set stateChangeEvents(e){e?this.setAttribute("state-change-events",""):this.removeAttribute("state-change-events")}get readyMessage(){return this.hasAttribute("ready-message")}set readyMessage(e){e?this.setAttribute("ready-message",""):this.removeAttribute("ready-message")}get mouseEvents(){const e=this.getAttribute("mouse-events");return e===null?null:e===""?["click","dblclick","mousedown","mouseup"]:e.split(",")}set mouseEvents(e){e===null?this.removeAttribute("mouse-events"):this.setAttribute("mouse-events",e.join(","))}get reload(){return this.getAttribute("reload")}set reload(e){this.setAttribute("reload",e)}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(e){var a;if(e.source===((a=this.iframeElement)==null?void 0:a.contentWindow)){const t=e.data;if(this.log("debug","received message from child",t),Array.isArray(e.data)){if(q(t)&&(this.postMessageToChild(["df-parent","init",{id:this.id,debug:this.debug,resize:this.resize,syncParams:this.syncParams!==null,syncPath:this.syncPath!==null,stateChangeEvents:this.stateChangeEvents,mouseEvents:this.mouseEvents,src:this.currentChildSrc}]),this.childInitialized=!0),B(t)&&(this.resizedHeight=t[2],this.resize==="yes"&&!this.ready&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready"))),this.updateStyle()),G(t)){if(this.currentChildSrc=t[3],this.parsedSyncParams||this.syncPath){const i=w(this.fullSrc,t[3],window.location.href,this.parsedSyncParams,this.syncPath);if(i.href!==window.location.href){this.log("debug","apply state change to parent",t[2],i.href);try{this.adapter.stateChange(t[2],i,this)}catch(n){this.log("error","failed to apply state change to parent using custom adapter",n),this.windowAdapter.stateChange(t[2],i,this)}}}this.stateChangeEvents&&this.dispatchEvent(new CustomEvent("state-change",{detail:[t[2],t[3]]}))}if(V(t)&&this.dispatchEvent(new CustomEvent("message",{detail:t[2]})),_(t)&&this.dispatchEvent(new CustomEvent("notif",{detail:t[2]})),J(t)&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()),Q(t)&&this.applySyncedMouseEvent(t),X(t)){const i=w(this.fullSrc,t[2],window.location.href,this.parsedSyncParams,this.syncPath).href;this.parentUrlListeners[t[2]]=i,this.postMessageToChild(["df-parent","parentUrl",t[2],i])}Y(t)&&delete this.parentUrlListeners[t[2]]}else pe(t)&&this.dispatchEvent(new CustomEvent("notif",{detail:ge(t.uiNotification)}))}}postMessageToChild(e){var a,t;this.log("debug","send message to child",e),(t=(a=this.iframeElement)==null?void 0:a.contentWindow)==null||t.postMessage(e)}updateSrc(){if(!this.connected)return;for(const[a,t]of Object.entries(this.parentUrlListeners)){const i=w(this.fullSrc,a,window.location.href,this.parsedSyncParams,this.syncPath).href;i!==t&&(this.parentUrlListeners[a]=i,this.postMessageToChild(["df-parent","parentUrl",a,i]))}const e=fe(this.fullSrc,window.location.href,this.parsedSyncParams,this.syncPath);e!==this.currentChildSrc&&(this.currentChildSrc=e,this.childInitialized?this.postMessageToChild(["df-parent","updateSrc",e]):(this.log("debug","set src attribute of iframe: "+e),this.iframeElement.setAttribute("src",e)))}updateStyle(){if(!this.connected)return;let e;this.resizedHeight?(this.log("debug","height of iframe based on resize message: "+this.resizedHeight),e=this.resizedHeight+"px"):this.height?(this.log("debug","height of iframe based on direct attribute: "+this.height),e=this.height):this.aspectRatio!==null&&(this.log("debug","height of iframe based on aspect ratio: "+this.aspectRatioHeight),e=this.aspectRatioHeight+"px"),e!==void 0?(this.log("debug","set height iframe wrapper: "+e),this.wrapperElement.style.cssText=`height:${e};min-height:0;`):this.wrapperElement.style.cssText="",this.resize==="yes"||this.resize==="auto"&&this.resizedHeight?this.iframeElement.getAttribute("scrolling")!=="no"&&(this.log("debug","set scrolling attribute of iframe: no"),this.iframeElement.setAttribute("scrolling","no")):this.iframeElement.getAttribute("scrolling")!=="auto"&&(this.log("debug","set scrolling attribute of iframe: auto"),this.iframeElement.setAttribute("scrolling","auto")),this.ready&&this.iframeElement.getAttribute("style")!==""&&(this.log("debug","toggle loading slot and iframe visibility"),this.iframeElement.style.cssText="",this.slotElement.style.cssText="display:none;")}updateAspectRatioHeight(){this.width&&this.aspectRatio!==null&&(this.resizedHeight||this.height||(this.aspectRatioHeight=Math.ceil(this.width/this.actualAspectRatio),this.updateStyle()))}updateIframeExtraAttrs(){const e=this.iframeExtraAttrs,a={};for(const t of this.getAttributeNames())if(t.startsWith("iframe-")){const i=this.getAttribute(t);if(i!==null){const n=t.slice(7);a[n]=i}}this.log("debug","update iframe extra attributes",e,a);for(const t of Object.keys(e))t in a||this.iframeElement.removeAttribute(t);for(const t of Object.keys(a))a[t]!==e[t]&&this.iframeElement.setAttribute(t,a[t])}initMouseEvents(e){this.log("debug","initMouseEvents");for(const a of e)if(!this.mouseEventListeners[a]){const t=i=>{i instanceof MouseEvent&&this.transmitSyncedMouseEvent(["df-global","mouse",a,{altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}])};this.mouseEventListeners[a]=t,document.addEventListener(a,t,!0)}}transmitSyncedMouseEvent(e){this.currentSyncedMouseEvents.has(e[2])?this.currentSyncedMouseEvents.delete(e[2]):this.postMessageToChild(e)}applySyncedMouseEvent(e){this.currentSyncedMouseEvents.add(e[2]);const a=new MouseEvent(e[2],{bubbles:!0,cancelable:!0,view:window,...e[3]});this.dispatchEvent(a)}log(e,...a){e==="debug"&&!this.debug||(e==="debug"&&console.timeLog(`d-frame:${this.id}`,...a),e==="info"&&console.info(`d-frame:${this.id}`,...a),e==="error"&&console.error(`d-frame:${this.id}`,...a))}connectedCallback(){if(!this.debug){const e=window.localStorage.getItem("debug");if(e){const a=e.split(",");(a.includes("d-frame")||a.includes("d-frame:"+this.id))&&(this.debug=!0)}}if(this.debug&&console.time(`d-frame:${this.id}`),!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.connected=!0,this.adapter.onStateChange&&this.adapter.onStateChange(()=>{this.updateSrc()}),this.resizeObserver.observe(this),window.addEventListener("message",this.boundOnMessage),this.syncParams!==null&&(this.parsedSyncParams=ue(this.syncParams||"*")),this.updateStyle(),this.updateIframeExtraAttrs(),this.updateSrc(),this.mouseEvents&&this.initMouseEvents(this.mouseEvents)}disconnectedCallback(){this.log("debug","disconnected"),this.resizeObserver.disconnect(),window.removeEventListener("message",this.boundOnMessage);for(const[e,a]of Object.entries(this.mouseEventListeners))document.removeEventListener(e,a,!0),delete this.mouseEventListeners[e]}static get observedAttributes(){return["src","aspect-ratio","height","sync-params","sync-path","reload"]}attributeChangedCallback(e,a,t){var i;if(e==="aspect-ratio"&&this.updateAspectRatioHeight(),!!this.connected&&(this.log("debug","attribute change",e,a,t),e==="src"&&this.updateSrc(),e==="height"&&this.updateStyle(),e==="sync-params"&&this.updateSrc(),e==="sync-path"&&this.updateSrc(),e==="reload")){if(!this.currentChildSrc){this.log("debug","reload attribute changed but the iframe has no current src");return}if(!((i=this.iframeElement.contentWindow)!=null&&i.location)){this.log("debug","reload attribute changed but no iframe contentWindow, is this a cross domain iframe ?");return}if(!this.iframeLoaded){this.log("debug","reload attribute changed before initial loading was complete, ignore it");return}this.log("debug","reload iframe with current src",this.currentChildSrc),this.childInitialized=!1,this.iframeElement.setAttribute("src",this.currentChildSrc),this.iframeElement.contentWindow.location.reload()}}}customElements.define("d-frame",be);
