var p=Object.defineProperty;var u=(i,s,t)=>s in i?p(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var n=(i,s,t)=>u(i,typeof s!="symbol"?s+"":s,t);import{b as g,c as f,d as m}from"./C0vl7zmO.js";const b=i=>i.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");function y(i){const s=[];for(const t of i.split(",")){const[r="*",e]=t.split(":"),a="^"+b(r).replace(/\\\*/g,"(.*)")+"$";s.push({regexp:new RegExp(a),append:e})}return s}function w(i,s,t){return s&&new URL(t).searchParams.forEach((e,a)=>{for(const o of s){if(o.append&&!a.startsWith(o.append))continue;const h=o.append?a.replace(o.append,""):a;if(h.match(o.regexp)){i.searchParams.set(h,e);break}}}),i.href}function A(i,s,t,r){const e=new URL(r),a=new URL(t);return e.searchParams.forEach((o,h)=>{for(const c of s){if(c.append&&!h.startsWith(c.append))continue;const l=c.append?h.replace(c.append,""):h;if(l.match(c.regexp)){a.searchParams.get(l)===null&&e.searchParams.delete(h);break}}}),a.searchParams.forEach((o,h)=>{for(const c of s){if(!h.match(c.regexp)||(i==null?void 0:i.searchParams.get(h))===o)continue;const l=c.append?c.append+h:h;e.searchParams.set(l,o);break}}),e}class S{stateChange(s,t){s==="replace"&&window.history.replaceState(null,"",t),s==="push"&&window.history.pushState(null,"",t)}}const d=document.createElement("template");d.innerHTML=`<style>
  :host {
    display: block;
  }
  iframe.d-frame-iframe {
    display: block;
    width: 100%;
    border: none;
    max-height: 100%;
  }
</style><slot name="loader"></slot><iframe class="d-frame-iframe" frameborder="0">`;class z extends HTMLElement{constructor(){super();n(this,"adapter");n(this,"initialSrc");n(this,"srcUrl");n(this,"parsedSyncParams");n(this,"iframeElement");n(this,"slotElement");n(this,"width");n(this,"aspectRatioHeight");n(this,"resizedHeight");const t=d.content.cloneNode(!0);this.slotElement=t.childNodes[1],this.resize!=="yes"&&(this.slotElement.style.display="none"),this.iframeElement=t.childNodes[2],this.iframeElement.setAttribute("scrolling",this.resize==="yes"?"no":"auto"),this.iframeElement.setAttribute("loading",this.lazy?"lazy":"eager"),this.attachShadow({mode:"open"}).appendChild(t),new ResizeObserver(a=>{this.width!==a[0].contentRect.width&&(this.width=a[0].contentRect.width,this.updateAspectRatioHeight())}).observe(this),this.adapter=new S,window.addEventListener("message",a=>this.onMessage(a))}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}get lazy(){return this.hasAttribute("lazy")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get aspectRatio(){return this.getAttribute("aspect-ratio")??"auto"}set aspectRatio(t){this.setAttribute("aspect-ratio",t)}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}set resize(t){this.setAttribute("resize",t)}get resize(){const t=this.getAttribute("resize");return t===null?"auto":t===""?"yes":t}get syncParams(){return this.getAttribute("sync-params")}set syncParams(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(t){var r;if(t.source===((r=this.iframeElement)==null?void 0:r.contentWindow)&&Array.isArray(t.data)){const e=t.data;if(this.log("debug","received message from child",e),g(e)&&(this.postMessageToChild(["df-parent","init",{debug:this.debug,resize:this.resize,syncParams:this.syncParams!==null}]),this.init()),f(e)&&(this.resizedHeight=e[2],this.updateStyle()),m(e)&&this.parsedSyncParams){const a=A(this.srcUrl,this.parsedSyncParams,e[3],window.location.href);a.href!==window.location.href&&this.adapter.stateChange(e[2],a)}}}init(){this.initialSrc=this.src}postMessageToChild(t){var r,e;this.log("debug","send message to child",t),(e=(r=this.iframeElement)==null?void 0:r.contentWindow)==null||e.postMessage(t)}updateSrc(){this.srcUrl=new URL(this.src.startsWith("/")?window.location.origin+this.src:this.src);const t=w(this.srcUrl,this.parsedSyncParams,window.location.href);this.initialSrc?this.postMessageToChild(["df-parent","updateSrc",t]):this.iframeElement.setAttribute("src",t)}updateStyle(){let t="";(this.resize==="yes"||this.resize==="auto"&&this.resizedHeight)&&(this.iframeElement.setAttribute("scrolling","no"),this.resizedHeight?(this.slotElement.style.display="none",t+=`height:${this.resizedHeight}px;`):this.height?(this.slotElement.style.display="none",t+=`height:${this.height};`):this.aspectRatio!=="auto"?(this.slotElement.style.display="none",t+=`height:${this.aspectRatioHeight}px;`):(this.slotElement.style.display="block",t+="height:0;")),(this.resize==="no"||this.resize==="auto"&&!this.resizedHeight)&&(this.iframeElement.setAttribute("scrolling","auto"),this.height?t+=`height:${this.height};`:t+=`height:${this.aspectRatioHeight}px;`),this.iframeElement.setAttribute("style",t)}updateAspectRatioHeight(){this.width&&(this.resizedHeight||this.height||(this.aspectRatioHeight=this.width/this.actualAspectRatio,this.updateStyle()))}log(t,...r){t==="debug"&&!this.debug||(t==="debug"&&console.debug("d-frame",...r),t==="info"&&console.info("d-frame",...r))}connectedCallback(){if(!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.adapter.onStateChange&&this.adapter.onStateChange(()=>{this.updateSrc()}),this.syncParams!==null&&(this.parsedSyncParams=y(this.syncParams||"*")),this.updateSrc(),this.updateStyle()}static get observedAttributes(){return["src","aspect-ratio","height","sync-params"]}attributeChangedCallback(t,r,e){this.log("debug","attribute change",t,r,e),t==="aspect-ratio"&&this.updateAspectRatioHeight(),t==="src"&&this.updateSrc(),t==="height"&&this.updateStyle(),t==="sync-params"&&this.updateSrc()}}customElements.define("d-frame",z);
