var I=Object.defineProperty;var O=(e,i,t)=>i in e?I(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var c=(e,i,t)=>O(e,typeof i!="symbol"?i+"":i,t);import{b as N,c as W,d as $,e as F,f as j,g as D}from"./BvdkFZoE.js";const b=customElements,A=HTMLElement,{hasAttribute:B,setAttribute:P,removeAttribute:R,getAttribute:y}=A.prototype,{apply:f,setPrototypeOf:L,construct:G}=Reflect,{defineProperties:K}=Object,{get:S,define:V,whenDefined:U}=CustomElementRegistry.prototype,q=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected").get;function _(e){try{return String(e)}catch{}return""}function J(e){const{connectedCallback:i,disconnectedCallback:t,adoptedCallback:a,attributeChangedCallback:s,formAssociatedCallback:r,formDisabledCallback:o,formResetCallback:n,formStateRestoreCallback:h}=e.prototype,l=new Set(e.observedAttributes||[]),d=e.formAssociated||!1;return{LatestCtor:e,connectedCallback:i,disconnectedCallback:t,adoptedCallback:a,formAssociatedCallback:r,formDisabledCallback:o,formResetCallback:n,formStateRestoreCallback:h,attributeChangedCallback:s,observedAttributes:l,formAssociated:d}}function T(e,i){return new Set([...e.observedAttributes].filter(t=>!i.observedAttributes.has(t)))}function Q(e,i,t){const{observedAttributes:a,attributeChangedCallback:s}=t;if(a.size===0||!s)return;const r=T(i,t);r.size!==0&&K(e,{setAttribute:{value:function(n,h){if(r.has(n)){const l=y.call(this,n);P.call(this,n,h),s.call(this,n,l,_(h))}else P.call(this,n,h)},writable:!0,enumerable:!0,configurable:!0},removeAttribute:{value:function(n){if(r.has(n)){const h=y.call(this,n);R.call(this,n),s.call(this,n,h,null)}else R.call(this,n)},writable:!0,enumerable:!0,configurable:!0}})}function X(e,i){var t;return t=class extends A{constructor(s,r){if(super(),s)return E(this,e,s,r),this;s=g.get(i),s?E(this,e,s):(v.set(this,e),L(this,m.prototype))}connectedCallback(){var r;const s=u.get(this);if(s)(r=s.connectedCallback)==null||r.call(this);else{let o=p.get(i);o||p.set(i,o=new Set),o.add(this)}}disconnectedCallback(){var r;const s=u.get(this);if(s)(r=s.disconnectedCallback)==null||r.call(this);else{const o=p.get(i);o&&o.delete(this)}}adoptedCallback(){var r;const s=u.get(this);(r=s==null?void 0:s.adoptedCallback)==null||r.call(this)}formAssociatedCallback(){var r;const s=u.get(this);(r=s==null?void 0:s.formAssociatedCallback)==null||r.apply(this,arguments)}formDisabledCallback(){var r;const s=u.get(this);(r=s==null?void 0:s.formDisabledCallback)==null||r.apply(this,arguments)}formResetCallback(){var r;const s=u.get(this);(r=s==null?void 0:s.formResetCallback)==null||r.apply(this,arguments)}formStateRestoreCallback(){var r;const s=u.get(this);(r=s==null?void 0:s.formStateRestoreCallback)==null||r.apply(this,arguments)}attributeChangedCallback(...s){var o;const r=u.get(this);(e===r||r!=null&&r.observedAttributes.has(s[0]))&&((o=r.attributeChangedCallback)==null||o.apply(this,s))}},t.observedAttributes=e.observedAttributes,t.formAssociated=e.formAssociated,t}let w;const u=new WeakMap,v=new WeakMap,M=new WeakMap,z=new Map,g=new Map,C=new Map,k=new Map,H=new Map,p=new Map;function E(e,i,t,a){var o;L(e,t.LatestCtor.prototype),u.set(e,t),t!==i&&Q(e,i,t),w=e,G(t.LatestCtor,a||[]);const{observedAttributes:s,attributeChangedCallback:r}=t;if(s.size>0&&r){const n=T(i,t);n.size>0&&n.forEach(h=>{if(B.call(e,h)){const l=y.call(e,h);r.call(e,h,null,l)}})}f(q,e,[])&&((o=t.disconnectedCallback)==null||o.call(e))}function Y(e){if(!e||!e.prototype||typeof e.prototype!="object")throw new TypeError("The referenced constructor is not a constructor.");let i=M.get(e);return i||(i=J(e),M.set(e,i)),i}const m=function(...i){if(!new.target)throw new TypeError("Failed to construct 'HTMLElement': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(new.target===m)throw new TypeError("Illegal constructor");const t=w;if(t)return w=void 0,t;const{constructor:a}=this,s=C.get(a);if(!s||!s.PivotCtor)throw new TypeError("Illegal constructor");return new s.PivotCtor(s,i)};m.prototype=A.prototype;Object.assign(CustomElementRegistry.prototype,{get(...e){var t;if(this!==b)throw new TypeError("Illegal invocation");const{0:i}=e;return f(S,this,e)&&((t=g.get(i))==null?void 0:t.LatestCtor)},define(...e){var h;if(this!==b)throw new TypeError("Illegal invocation");const{0:i,1:t,2:a}=e;if(a&&a.extends)throw new DOMException("NotSupportedError: ");let s=f(S,this,[i]);if(s&&s!==((h=g.get(i))==null?void 0:h.PivotCtor))throw new DOMException(`Failed to execute 'define' on 'CustomElementRegistry': the name "${i}" has already been used with this registry`);const r=Y(t);if(C.get(t))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': this constructor has already been used with this registry");g.set(i,r),C.set(t,r),s=z.get(i),s||(s=X(r,i),z.set(i,s),f(V,this,[i,s])),r.PivotCtor=s;const o=p.get(i);o&&(p.delete(i),o.forEach(l=>{const d=v.get(l);d&&(v.delete(l),E(l,d,r))}));const n=H.get(i);n&&n(t)},whenDefined(...e){if(this!==b)throw new TypeError("Illegal invocation");const{0:i}=e;return f(U,this,e).then(()=>{let t=k.get(i);if(!t){const a=g.get(i);if(a)return Promise.resolve(a.LatestCtor);let s;t=new Promise(r=>{s=r}),k.set(i,t),H.set(i,s)}return t})},constructor:m});window.HTMLElement=m;function Z(e){return e.endsWith("/")?e:e===""?"/":e.slice(0,e.lastIndexOf("/")+1)}function tt(e,i){if(i.origin!==e.origin)return i.href;if(i.pathname===e.pathname)return"";const t=Z(e.pathname);return i.pathname.startsWith(t)?i.pathname.replace(t,"./"):i.pathname}const et=e=>e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");function st(e){const i=[];for(const t of e.split(",")){const[a="*",s]=t.split(":"),r="^"+et(a).replace(/\\\*/g,"(.*)")+"$";i.push({regexp:new RegExp(r),append:s})}return i}function it(e,i,t,a){if(!t&&!a)return e.href;const s=new URL(i);if(t&&s.searchParams.forEach((r,o)=>{for(const n of t){if(n.append&&!o.startsWith(n.append)||o===a)continue;const h=n.append?o.replace(n.append,""):o;if(h.match(n.regexp)){e.searchParams.set(h,r);break}}}),a!==null){const r=s.searchParams.get(a);r&&(e.pathname=new URL(r,e).pathname)}return e.href}function rt(e,i,t,a,s){const r=new URL(t),o=new URL(i);if(a&&(r.searchParams.forEach((n,h)=>{for(const l of a){if(l.append&&!h.startsWith(l.append))continue;const d=l.append?h.replace(l.append,""):h;if(d.match(l.regexp)){o.searchParams.get(d)===null&&r.searchParams.delete(h);break}}}),o.searchParams.forEach((n,h)=>{for(const l of a){if(!h.match(l.regexp)||(e==null?void 0:e.searchParams.get(h))===n)continue;const d=l.append?l.append+h:h;r.searchParams.set(d,n);break}})),s!==null&&e){const n=tt(e,o);n?r.searchParams.set(s,n):r.searchParams.delete(s)}return r}function at(e){return e.vIframe===!0&&e.uiNotification!==void 0}function nt(e){if(typeof e=="string")return{type:"default",title:e};if(e.error&&!e.errorMsg){const i=e.error.response&&(e.error.response.data||e.error.response.status)||e.error.message||e.error;return e.msg?{type:"error",title:e.msg,detail:i}:{type:"error",title:i}}return e.type==="error"?{type:e.clientError?"warning":"error",title:e.msg,detail:e.errorMsg}:{type:e.type??"default",title:e.msg}}class ot{stateChange(i,t){i==="replace"&&window.history.replaceState(null,"",t),i==="push"&&window.history.pushState(null,"",t)}}const x=document.createElement("template");x.innerHTML=`<style>
  :host {
    display: block;
  }
  .d-frame-wrapper {
    height: 100%;
  }
  iframe.d-frame-iframe {
    display: block;
    width: 100%;
    height: 100%;
    border: none;
  }
</style><div class="d-frame-wrapper"><slot name="loading"><div style="min-height:150px;"></div></slot><iframe class="d-frame-iframe" frameborder="0" style="visibility:hidden;position:absolute;height:0px;"></iframe></div>`;class ht extends HTMLElement{constructor(){super();c(this,"adapter");c(this,"connected",!1);c(this,"initialSrc");c(this,"srcUrl");c(this,"parsedSyncParams");c(this,"wrapperElement");c(this,"slotElement");c(this,"iframeElement");c(this,"width");c(this,"aspectRatioHeight");c(this,"resizedHeight");c(this,"randomId");c(this,"iframeLoaded",!1);c(this,"ready",!1);this.randomId=Math.random().toString(36).slice(-6);const t=x.content.cloneNode(!0);this.wrapperElement=t.childNodes[1],this.slotElement=this.wrapperElement.childNodes[0],this.iframeElement=this.wrapperElement.childNodes[1],this.iframeElement.setAttribute("scrolling",this.resize==="yes"?"no":"auto"),this.iframeElement.setAttribute("loading",this.lazy?"lazy":"eager"),this.iframeElement.addEventListener("load",()=>{this.iframeElement.getAttribute("src")&&(this.log("debug","iframe loaded"),this.iframeLoaded=!0,this.dispatchEvent(new CustomEvent("iframe-load")),this.resize!=="yes"&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle()))}),this.attachShadow({mode:"open"}).appendChild(t),new ResizeObserver(r=>{(this.width===void 0||Math.abs(this.width-r[0].contentRect.width)>2)&&(this.width=r[0].contentRect.width,this.updateAspectRatioHeight())}).observe(this),this.adapter=new ot,window.addEventListener("message",r=>this.onMessage(r))}get id(){return this.getAttribute("id")??this.randomId}set id(t){this.setAttribute("id",t)}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}get lazy(){return this.hasAttribute("lazy")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get aspectRatio(){const t=this.getAttribute("aspect-ratio");return t===""?"auto":t}set aspectRatio(t){t!==null?this.setAttribute("aspect-ratio",t):this.removeAttribute("aspect-ratio")}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}set resize(t){this.setAttribute("resize",t)}get resize(){const t=this.getAttribute("resize");return t===null?"auto":t===""?"yes":t}get syncParams(){return this.getAttribute("sync-params")}set syncParams(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get syncPath(){const t=this.getAttribute("sync-path");return t===null?null:t||"p"}set syncPath(t){t!==null?this.setAttribute("sync-params",t):this.removeAttribute("sync-params")}get stateChangeEvents(){return this.hasAttribute("state-change-events")}set stateChangeEvents(t){t?this.setAttribute("state-change-events",""):this.removeAttribute("state-change-events")}get readyMessage(){return this.hasAttribute("ready-message")}set readyMessage(t){t?this.setAttribute("ready-message",""):this.removeAttribute("ready-message")}get actualAspectRatio(){return this.aspectRatio!=="auto"?Number(this.aspectRatio):!this.width||this.width<500?1:this.width<800?4/3:this.width<1200?16/9:21/9}onMessage(t){var a;if(t.source===((a=this.iframeElement)==null?void 0:a.contentWindow)){const s=t.data;if(this.log("debug","received message from child",s),Array.isArray(t.data)){if(N(s)&&(this.postMessageToChild(["df-parent","init",{id:this.id,debug:this.debug,resize:this.resize,syncParams:this.syncParams!==null,syncPath:this.syncPath!==null,stateChangeEvents:this.stateChangeEvents}]),this.init()),W(s)&&(this.resizedHeight=s[2],this.resize==="yes"&&!this.ready&&!this.readyMessage&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready"))),this.updateStyle()),$(s)){if(this.parsedSyncParams||this.syncPath){const r=rt(this.srcUrl,s[3],window.location.href,this.parsedSyncParams,this.syncPath);r.href!==window.location.href&&this.adapter.stateChange(s[2],r)}this.stateChangeEvents&&this.dispatchEvent(new CustomEvent("state-change",{detail:[s[2],s[3]]}))}F(s)&&this.dispatchEvent(new CustomEvent("message",{detail:s[2]})),j(s)&&this.dispatchEvent(new CustomEvent("notif",{detail:s[2]})),D(s)&&(this.ready=!0,this.dispatchEvent(new CustomEvent("ready")),this.updateStyle())}else at(s)&&this.dispatchEvent(new CustomEvent("notif",{detail:nt(s.uiNotification)}))}}init(){this.initialSrc=this.src}postMessageToChild(t){var a,s;this.log("debug","send message to child",t),(s=(a=this.iframeElement)==null?void 0:a.contentWindow)==null||s.postMessage(t)}updateSrc(){if(!this.connected)return;this.srcUrl=new URL(this.src.startsWith("/")?window.location.origin+this.src:this.src);const t=it(this.srcUrl,window.location.href,this.parsedSyncParams,this.syncPath);this.initialSrc?this.postMessageToChild(["df-parent","updateSrc",t]):(this.log("debug","set src attribute of iframe: "+t),this.iframeElement.setAttribute("src",t))}updateStyle(){if(!this.connected)return;let t;this.resizedHeight?(this.log("debug","height of iframe based on resize message: "+this.resizedHeight),t=this.resizedHeight+"px"):this.height?(this.log("debug","height of iframe based on direct attribute: "+this.height),t=this.height):this.aspectRatio!==null&&(this.log("debug","height of iframe based on aspect ratio: "+this.aspectRatioHeight),t=this.aspectRatioHeight+"px"),t!==void 0?(this.log("debug","set height iframe wrapper: "+t),this.wrapperElement.setAttribute("style",`height:${t};min-height:0;`)):this.wrapperElement.setAttribute("style",""),this.resize==="yes"||this.resize==="auto"&&this.resizedHeight?this.iframeElement.getAttribute("scrolling")!=="no"&&(this.log("debug","set scrolling attribute of iframe: no"),this.iframeElement.setAttribute("scrolling","no")):this.iframeElement.getAttribute("scrolling")!=="auto"&&(this.log("debug","set scrolling attribute of iframe: auto"),this.iframeElement.setAttribute("scrolling","auto")),this.ready&&this.iframeElement.getAttribute("style")!==""&&(this.log("debug","toggle loading slot and iframe visibility"),this.iframeElement.setAttribute("style",""),this.slotElement.setAttribute("style","display:none;"))}updateAspectRatioHeight(){this.width&&this.aspectRatio!==null&&(this.resizedHeight||this.height||(this.aspectRatioHeight=Math.ceil(this.width/this.actualAspectRatio),this.updateStyle()))}log(t,...a){t==="debug"&&!this.debug||(t==="debug"&&console.timeLog(`d-frame:${this.id}`,...a),t==="info"&&console.info(`d-frame:${this.id}`,...a))}connectedCallback(){if(!this.debug){const t=window.localStorage.getItem("debug");if(t){const a=t.split(",");(a.includes("d-frame")||a.includes("d-frame:"+this.id))&&(this.debug=!0)}}if(this.debug&&console.time(`d-frame:${this.id}`),!this.hasAttribute("src"))throw new Error("src is a required attribute");this.log("debug","connected"),this.connected=!0,this.adapter.onStateChange&&this.adapter.onStateChange(()=>{this.updateSrc()}),this.syncParams!==null&&(this.parsedSyncParams=st(this.syncParams||"*")),this.updateStyle(),this.updateSrc()}disconnectedCallback(){this.log("debug","disconnected"),this.debug&&console.timeEnd(`d-frame:${this.id}`)}static get observedAttributes(){return["src","aspect-ratio","height","sync-params","sync-path"]}attributeChangedCallback(t,a,s){t==="aspect-ratio"&&this.updateAspectRatioHeight(),this.connected&&(this.log("debug","attribute change",t,a,s),t==="src"&&this.updateSrc(),t==="height"&&this.updateStyle(),t==="sync-params"&&this.updateSrc(),t==="sync-path"&&this.updateSrc())}}customElements.define("d-frame",ht);
